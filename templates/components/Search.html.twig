<div {{ attributes.defaults(stimulus_controller('search')) }}>
    <div class="row">
        <div class="col-md-12 position-relative">
            <div class="search"  data-search-target="search">
                <div class="input-group">
                    <input type="search"
                           class="form-control-lg w-100"
                           id="search"
                           placeholder="Search for..."
                           data-model="debounce(500)|query"
                           data-search-target="query"
                           data-action="focus->search#suggest blur->search#suggest"
                    />
                </div>
                <div data-search-target="suggestions" class="shadow position-absolute p-3 d-none bg-body border" style="z-index: 1000">
                    {% for facet in facets|default([]) %}
                        {% for count in facet.counts %}
                            {% set value = facet.field_name ~':"'~ count.value ~'"'  %}
                            {% if count.value =='true'%}
                                {% set value = '#'~facet.field_name  %}
                            {% elseif count.value =='false'%}
                                {% set value = '#not_'~facet.field_name  %}
                            {% endif %}
                            {% set isIncluded = value in filters %}
                            <button type="button" class="btn badge {{ isIncluded?'bg-success':'bg-secondary' }} btn-bare suggestion"
                                        data-action="live#action click->search#focus"
                                        data-live-action-param="addToQuery"
                                        data-live-value-param='{{ value }}'
                                >
                                    <small>
                                        {{ value }}
                                        <span class="badge rounded-pill bg-primary">
                                    {{ count.count }}
                                    <span class="visually-hidden">records</span>
                                </span>
                                    </small>
                                </button>
                        {% endfor %}
                    {% endfor %}
                </div>
            </div>

            <div class="my-2">
            {% for filter in filters %}
                <button type="button" class="btn btn-bare badge bg-primary"
                        data-action="live#action"
                        data-live-action-param="addToQuery"
                        data-live-value-param="{{ filter }}"
                >
                    {{ filter }} <i class="bi bi-x-circle"></i>
                </button>
            {% endfor %}
            </div>

            {% if fullQuery!='' %}
            <span class="badge bg-secondary">{{ found }} results</span>
            {% endif %}

            couverture, liste de lecture, lus, age, orderby

        </div>

        {% if fullQuery!='' and books|length >0 %}

            <div class="results mt-4">
            {% set route='app_allbooks' %}
            {% set params={'page':page, 'fullQuery': fullQuery} %}
            {% set current= pagination.page %}
            <nav aria-label="Navigate through results">
                <ul class="pagination">
                    {% if pagination.previousPage is not null %}
                        <li class="page-item">
                            <a class="page-link" href="{{ path(route, params|merge({'page':pagination.previousPage})) }}">Previous</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#">Previous</a>
                        </li>
                    {% endif %}
                    {% if current > 1 %}
                        <li class="page-item"><a class="page-link" href="{{ path(route, params|merge({'page':1})) }}">1</a></li>
                    {% endif %}

                    {% if current-1 > 2 %}
                        <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                    {% endif %}

                    {% if current-1 >=2 %}
                        <li class="page-item"><a class="page-link" href="{{ path(route, params|merge({'page':pagination.page-1})) }}">{{ current-1 }}</a></li>
                    {% endif %}

                    <li class="page-item active"><a class="page-link" href="{{ path(route, params|merge({'page':pagination.page})) }}">{{ current }}</a></li>


                    {% if current <= pagination.lastPage-1 %}
                        <li class="page-item"><a class="page-link" href="{{ path(route, params|merge({'page':pagination.page+1})) }}">{{ current+1 }}</a></li>
                    {% endif %}

                    {% if current+1 < pagination.lastPage-1 %}
                        <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                    {% endif %}

                    {% if current < pagination.lastPage-1 %}
                        <li class="page-item"><a class="page-link" href="{{ path(route, params|merge({'page':pagination.lastPage})) }}">{{ pagination.lastPage }}</a></li>
                    {% endif %}

                    {% if pagination.nextPage is not null %}
                        <li class="page-item">
                            <a class="page-link" href="{{ path(route, params|merge({'page':pagination.nextPage})) }}">Next</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>

            <div class="row">
                {% for book in books %}
                    <div class="col-md-4 col-lg-3 col-xl-2 col-sm-4 col-6">
                        {% include themedTemplate('book/_teaser.html.twig') with {book: book.book} %}
                    </div>
                {% endfor %}
            </div>
            </div>
        {% endif %}
    </div>
</div>
