<div {{ attributes.defaults(stimulus_controller('search')) }}>
    <div class="row">
        <div class="col-md-12 position-relative">
            <div class="search"  data-search-target="search">
                <div class="input-group">
                    <input type="search"
                           class="form-control-lg w-100"
                           id="search"
                           placeholder="Search for..."
                           data-model="debounce(500)|query"
                           data-search-target="query"
                           data-action="focus->search#suggest blur->search#suggest"
                    />
                </div>
                <div data-search-target="suggestions" class="shadow position-absolute p-3 d-none bg-body border" style="z-index: 1000">
                    <div class="container">
                        <div class="row">
                            {% for facet in facets|default([]) %}
                                {% if facet|length==4 %}
                                    <div class="col">
                                        <h5>{{ facet.field_name|capitalize }}</h5>
                                        <ul class="list-group">
                                            {% for count in facet.counts %}
                                                {% include 'components/_facet.html.twig' %}
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% endif %}
                            {% endfor %}
                            <div class="col">
                                <h5>Status</h5>
                                <ul class="list-group">
                                    {% for facet in facets|default([]) %}
                                        {% if facet|length==2 %}
                                            {% for count in facet.counts %}
                                                {% include 'components/_facet.html.twig' %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="my-2">
            {% for filter in filters %}
                <button type="button" class="btn btn-bare badge {% if 'orderBy' not in filter %}bg-primary{% else %}bg-secondary{% endif %}"
                        data-action="live#action"
                        data-live-action-param="addToQuery"
                        data-live-value-param="{{ filter }}"
                >
                    {{ filter }}
                    {% if 'orderBy' not in filter %}
                    <i class="bi bi-x-circle"></i>
                    {% endif %}
                </button>
            {% endfor %}
            </div>

            {% if fullQuery!='' %}
            <span class="badge bg-secondary">{{ found }} results</span>
            {% endif %}

        </div>

        {% if fullQuery!='' and books|length >0 %}

            <div class="results mt-4">
                <div class="row">
                    <div class="col">
                        {% set route='app_allbooks' %}
                        {% set params={'page':page, 'fullQuery': fullQuery} %}
                        {% set current= pagination.page %}
                        <nav aria-label="Navigate through results">
                            <ul class="pagination">
                                {% if pagination.previousPage is not null %}
                                    <li class="page-item">
                                        <a class="page-link" href="{{ path(route, params|merge({'page':pagination.previousPage})) }}">Previous</a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#">Previous</a>
                                    </li>
                                {% endif %}
                                {% if current > 1 %}
                                    <li class="page-item"><a class="page-link" href="{{ path(route, params|merge({'page':1})) }}">1</a></li>
                                {% endif %}

                                {% if current-1 > 2 %}
                                    <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                                {% endif %}

                                {% if current-1 >=2 %}
                                    <li class="page-item"><a class="page-link" href="{{ path(route, params|merge({'page':pagination.page-1})) }}">{{ current-1 }}</a></li>
                                {% endif %}

                                <li class="page-item active"><a class="page-link" href="{{ path(route, params|merge({'page':pagination.page})) }}">{{ current }}</a></li>


                                {% if current <= pagination.lastPage-1 %}
                                    <li class="page-item"><a class="page-link" href="{{ path(route, params|merge({'page':pagination.page+1})) }}">{{ current+1 }}</a></li>
                                {% endif %}

                                {% if current+1 < pagination.lastPage-1 %}
                                    <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                                {% endif %}

                                {% if current < pagination.lastPage-1 %}
                                    <li class="page-item"><a class="page-link" href="{{ path(route, params|merge({'page':pagination.lastPage})) }}">{{ pagination.lastPage }}</a></li>
                                {% endif %}

                                {% if pagination.nextPage is not null %}
                                    <li class="page-item">
                                        <a class="page-link" href="{{ path(route, params|merge({'page':pagination.nextPage})) }}">Next</a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                    <div class="col text-end">
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-arrow-down-up"></i>
                            </button>
                            <ul class="dropdown-menu">
                                {% for orderField in ['serieIndex','updated'] %}
                                    {% for order in ['asc','desc'] %}
                                        {% set isIncluded= orderField~"-"~order in fullQuery %}
                                        <li>
                                        <button type="button" class="dropdown-item btn {{ isIncluded?'active':''}} "
                                                data-action="live#action click->search#focus"
                                                data-live-action-param="addToQuery"
                                                data-live-value-param='orderBy:{{ orderField }}-{{ order }}'
                                        >
                                            <small>{{ orderField|trans }} {{ order }}</small>
                                        </button>
                                        </li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="row">
                    {% for book in books %}
                        <div class="col-md-4 col-lg-3 col-xl-2 col-sm-4 col-6">
                            {% include themedTemplate('book/_teaser.html.twig') with {book: book.book} %}
                        </div>
                    {% endfor %}
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="input-group">
                            <input type="text" class="form-control" data-model="shelfname" placeholder="Shelf" aria-label="Add to shelf">

                            <button
                                data-action="live#action"
                                data-live-action-param="save"
                                class="btn btn-outline-success align-content-end"
                            >
                                <i class="bi bi-journal-check"></i> Save to shelf
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>
